{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans Search %}{% endblock %}
{% block content %}
<div class="container">
	<div class="row">
		<div class="col-sm-12">
		<table id="secrets" class="table table-striped table-bordered" style="width:100%" data-server-side="true" data-ajax="/api/secrets/?format=datatables">
			<thead>
			<tr>
				<th data-data="name">{% trans "Secret" %}</th>
			</tr>
			</thead>
		</table>
		</div>
	</div>
</div>
<script>
	$(document).ready(function() {
		var table = $('#secrets').DataTable({
			"columnDefs": [{
				"targets": 0,
				"data": "name",
				"render": function (data, type, row, meta) {
					return '<a href="' + row.web_url + '">' + data + '</a>';
				}
			}],
			"pageLength": 50,
			"search": {
				"search": "{{ request.GET.search }}"
			},
			"dom": "rtip",
		});
		table.on('search.dt', function () {
			var url = new URL(window.location);
			url.searchParams.set('search', table.search());
			history.replaceState(null, null, url);
		});
		function delay(fn, ms) {
			let timer = 0
			return function(...args) {
				clearTimeout(timer)
				timer = setTimeout(fn.bind(this, ...args), ms || 0)
			}
		}
		$('#search').keyup(delay(function (e) {
			console.log("hi " + this.value);
			table.search(this.value).draw();
		}, 500));
		$('#search').select();
	});
</script>
{% endblock %}
