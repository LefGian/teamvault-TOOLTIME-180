{% extends "base.html" %}
{% load humanize %}
{% load i18n %}
{% load static %}
{% block title %}{{ secret.name }}{% endblock %}
{% block content %}
    <div class="large-type invisible"></div>

    <div class="container">
        <!-- Secret header -->
        <div class="row mb-3">
            <div class="col-lg-12">
                <h1 class="pull-left">
                    {{ secret.name }}
                </h1>
                <h1 class="pull-right secret-icons">
                    {% if secret.status == secret.STATUS_DELETED %}
                        <span data-bs-toggle="tooltip" data-bs-placement="bottom"
                              title="{% trans "This secret has been deleted and is not visible to regular users." %}"
                              class="text-danger-bright"><i class="fa fa-trash"></i></span>
                        <span class="text-muted-bright">|</span>
                    {% elif secret.status == secret.STATUS_NEEDS_CHANGING %}
                        <span data-bs-toggle="tooltip" data-bs-placement="bottom"
                              title="{% trans "This secret must be changed for security reasons. Please do so now." %}"
                              class="text-danger-bright"><i class="fa fa-refresh"></i>
                        </span>
                        <span class="text-muted-bright">|</span>
                    {% endif %}
                    {% if readable %}
                        <span data-bs-toggle="tooltip" data-bs-placement="bottom"
                              title="{% trans "You have access to this secret." %}" class="text-success-bright">
                            <i class="fa fa-unlock"></i>
                        </span>
                    {% else %}
                        <span data-bs-toggle="tooltip" data-bs-placement="bottom"
                              title="{% trans "You don't have access to this secret." %}" class="text-danger-bright">
                            <i class="fa fa-lock"></i>
                        </span>
                    {% endif %}
                </h1>
            </div>
        </div>

        <div class="row justify-content-between">
            <div class="col-lg-8 mb-3 mb-lg-0">
                <div class="card shadow">
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-12">
                                {% if readable %}
                                    {% block secret_content %}
                                    {% endblock %}
                                {% else %}
                                    <div class="alert alert-danger text-center">
                                        {% trans "You do not have access to this secret." %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if secret.url or secret.username or secret.description %}
                            <hr>
                            <div class="row mb-3 table-responsive">
                                <table class="align-middle justify-content-center secret-attributes">
                                    {% if secret.url %}
                                        <tr>
                                            <td>{% trans "URL" %}</td>
                                            <td>
                                                <a id="secret-url" href="{{ secret.url }}">{{ secret.url }}</a>
                                                <button class="btn btn-light bg-light btn-sm" id="copy-url"
                                                        data-clipboard-target="#secret-url"><i
                                                        class="fa fa-clipboard"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endif %}
                                    {% if secret.username %}
                                        <tr>
                                            <td>{% trans "Username" %}</td>
                                            <td>
                                                <span id="secret-username">{{ secret.username }}</span>
                                                <button class="btn btn-light bg-light btn-sm" id="copy-username"
                                                        data-clipboard-target="#secret-username"><i
                                                        class="fa fa-clipboard"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endif %}
                                    {% if secret.description %}
                                        <tr>
                                            <td>{% trans "Description" %}</td>
                                            <td>{{ secret.description|linebreaksbr|urlize }}</td>
                                        </tr>
                                    {% endif %}
                                </table>
                            </div>
                        {% endif %}
                        <hr>
                        <div class="row justify-content-between">
                            <div class="btn-group gap-2 px-lg-3" role="group">
                                <a class="btn btn-light bg-light btn-lg"
                                   href="{% url "secrets.secret-edit" secret.hashid %}">
                                    <i class="fa fa-pencil fa-fw text-info-emphasis"></i> {% trans "Edit" %}
                                </a>
                                <div class="vr"></div>
                                {% if secret.status == secret.STATUS_DELETED %}
                                    <a class="btn btn-light bg-light btn-lg"
                                       href="{% url "secrets.secret-restore" secret.hashid %}"
                                       title="{% trans "Undelete this secret" %}"><i
                                            class="fa fa-undo fa-fw text-info-emphasis"></i> {% trans "Restore" %}
                                    </a>
                                {% else %}
                                    <a class="btn btn-light bg-light btn-lg"
                                       href="{% url "secrets.secret-delete" secret.hashid %}"><i
                                            class="fa fa-trash fa-fw text-danger-emphasis"></i> {% trans "Delete" %}
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card shadow">
                    <div class="card-body table-responsive secret-meta">
                        <table class="table table-borderless align-middle">
                            <tr>
                                <td>{% trans "Changed" %}</td>
                                <td>
                                    <span data-bs-toggle="tooltip" data-bs-placement="top"
                                          title="{{ secret.last_changed|date:"Y-m-d H:i:s e" }}">
                                        {{ secret.last_changed|naturalday:"Y-m-d" }}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td>{% trans "Changed by" %}</td>
                                <td>{{ secret.current_revision.set_by.username }}</td>
                            </tr>
                            <tr class="border-top">
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>{% trans "Created" %}</td>
                                <td>
                                    <span data-bs-toggle="tooltip" data-bs-placement="top"
                                          title="{{ secret.created|date:"Y-m-d H:i:s e" }}">
                                        {{ secret.created|naturalday:"Y-m-d" }}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td>{% trans "Created by" %}</td>
                                <td>{{ secret.created_by.username }}</td>
                            </tr>
                            <tr class="border-top">
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>{% trans "Allowed" %}</td>
                                <td>
                                    <span data-bs-toggle="tooltip" data-bs-placement="left"
                                          title="{% for group in secret.allowed_groups.all %}{{ group.name }}<br>{% endfor %}">
                                        {% blocktrans with groupcount=secret.allowed_groups.all|length %}
                                            {{ groupcount }} group(s)
                                        {% endblocktrans %}
                                    </span>
                                    <br>
                                    <span data-bs-toggle="tooltip" data-bs-placement="left"
                                          title="{% for user in secret.allowed_users.all %}{{ user.username }}<br>{% endfor %}">
                                        {% blocktrans with usercount=secret.allowed_users.all|length %}
                                            {{ usercount }} user(s)
                                        {% endblocktrans %}
                                    </span>
                                </td>
                            </tr>
                        </table>
                        <hr>
                        {% if request.user.is_superuser %}
                            <a class="btn btn-light"
                               href="{% url 'audit.log' %}?secret={{ secret.hashid }}">
                                <i class="fa fa-address-card-o fa-fw text-info-emphasis"></i>
                                {% trans "Audit log" %}
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if su_access %}
        {% include "_su_confirm_modal.html" %}
    {% endif %}
    {% include 'secrets/detail_content/_js.html' %}
    <script src="{% static 'bundled/bigtext/dist/bigtext.js' %}"></script>
{% endblock %}
