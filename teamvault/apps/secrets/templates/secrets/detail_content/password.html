{% extends 'secrets/secret_detail.html' %}
{% load static %}
{% load i18n %}

{% block secret_content %}
    <div class="input-group input-group-lg">
        <input type="text" id="password-field" class="form-control" value="{{ placeholder }}"
               autocomplete="off" disabled>
        <div class="vr mx-1"></div>
        <button class="btn btn-light" id="copy-password" type="button"
                data-bs-toggle="tooltip"
                data-bs-placement="top" title="{% trans "Copy to clipboard" %}">
            <i class="fa fa-clipboard fa-fw"></i>
        </button>
        <button id="revealButton" class="btn btn-light" type="button"
                data-bs-toggle="tooltip"
                data-bs-placement="top" title="{% trans "Reveal as plain text" %}"
                onclick="getSecret(reveal)">
            <i class="fa fa-magic fa-fw"></i>
        </button>
        <button class="btn btn-light" type="button" data-bs-toggle="tooltip"
                data-bs-placement="top"
                title="{% trans "Show in large type" %}" onclick="getSecret(largeType);">
            <i class="fa fa-font fa-fw"></i>
        </button>
    </div>
{% endblock %}

{% block secret_attributes %}
    {% if secret.url or secret.username or secret.description %}
        <hr>
        <div class="row mb-3 table-responsive">
            <table class="align-middle justify-content-center secret-attributes">
                {% if secret.url %}
                    <tr>
                        <td>{% trans "URL" %}</td>
                        <td>
                            <a id="secret-url" href="{{ secret.url }}">{{ secret.url }}</a>
                            <button class="btn btn-light bg-light btn-sm" id="copy-url"
                                    data-clipboard-target="#secret-url"><i
                                    class="fa fa-clipboard"></i>
                            </button>
                        </td>
                    </tr>
                {% endif %}
                {% if secret.username %}
                    <tr>
                        <td>{% trans "Username" %}</td>
                        <td>
                            <span id="secret-username">{{ secret.username }}</span>
                            <button class="btn btn-light bg-light btn-sm" id="copy-username"
                                    data-clipboard-target="#secret-username"><i
                                    class="fa fa-clipboard"></i>
                            </button>
                        </td>
                    </tr>
                {% endif %}
                {% if secret.description %}
                    <tr>
                        <td>{% trans "Description" %}</td>
                        <td>{{ secret.description|linebreaksbr|urlize }}</td>
                    </tr>
                {% endif %}
            </table>
        </div>
    {% endif %}
{% endblock %}

{% block additionalJS %}
    <script>
        const largeTypeElement = document.querySelector('.large-type')
        largeTypeElement.addEventListener('mousedown', () => {
            largeTypeElement.classList.add('invisible')
            largeTypeElement.innerHTML = ''
        })

        function largeType(password) {
            largeTypeElement.classList.remove('invisible')
            largeTypeElement.innerHTML = `<div>${password}</div>`

            // TODO: Replace bigtext with something non-jquery
            $('.large-type').bigtext();
        }
    </script>
    <script>
        new ClipboardJS("#copy-password", {
            text: function () {
                return getSecretSync()['password'];
            }
        }).on('success', function (e) {
            e.clearSelection();
            notyf.success("{% trans "Password has been copied to your clipboard." %}");
        });

        new ClipboardJS("#copy-url").on('success', function (e) {
            e.clearSelection();
            notyf.success("{% trans "URL has been copied to your clipboard." %}");
        });

        new ClipboardJS("#copy-username").on('success', function (e) {
            e.clearSelection();
            notyf.success("{% trans "Username has been copied to your clipboard." %}");
        });
    </script>
{% endblock %}